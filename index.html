<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kisasa CRM Dashboard</title> 

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="stylesheet.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* === SIDEBAR STYLE LIKE LEADS PAGE === */
    .layout { display: flex; }
    .sidebar {
      width: 70px;
      background: #0f172a;
      color: white;
      position: fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 1.5rem;
      overflow-y: auto;
    }
    .sidebar h2 {
      color: white;
      font-size: 1.1rem;
      margin-bottom: 2rem;
      letter-spacing: 1px;
    }
    .sidebar nav a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      margin-bottom: 1.25rem;
      font-size: 1.25rem;
      color: #cbd5e1;
      border-radius: 8px;
      transition: all 0.2s;
      position: relative;
    }
    .sidebar nav a:hover,
    .sidebar nav a.active {
      background: #1e293b;
      color: white;
    }

    /* === DASHBOARD MAIN CONTENT === */
    .main.agent-ui {
      margin-left: 70px;
      flex: 1;
      padding: 2rem 2.5rem;
      max-width: 1400px;
    }

    /* Header & Actions */
    .agent-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .agent-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .filter-select {
      padding: 0.5rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      background: white;
    }
    .primary-btn {
      padding: 0.6rem 1.2rem;
      background: #3b82f6;
      color: white;
      font-weight: 500;
      border-radius: 6px;
      text-decoration: none;
      cursor: pointer;
      transition: background 0.2s;
      border: none;
      font-size: 0.95rem;
      display: inline-block;
    }
    .primary-btn:hover {
      background: #2563eb;
    }
    .agent-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .agent-name {
      font-weight: 600;
      font-size: 14px;
    }

    /* Task row & panel styling */
    .task-row {
      position: relative;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      background: #f9fafb;
      border-radius: 10px;
      font-size: 14px;
      gap: 12px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .task-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .task-info .name {
      font-weight: 600;
    }
    .task-info .detail {
      font-size: 13px;
      color: #6b7280;
    }
    .task-info .amount {
      font-weight: 600;
      color: #1e40af;
    }

    .menu-btn {
      background: none;
      border: none;
      font-size: 16px;
      color: #6b7280;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
    }
    .menu-btn:hover {
      background: #e5e7eb;
      color: #1f2937;
    }

    .status {
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 999px;
      margin-left: 8px;
    }
    .hot  { background: #fee2e2; color: #991b1b; }
    .warm { background: #fef3c7; color: #92400e; }
    .cold { background: #e0f2fe; color: #0369a1; }
    .draft { background: #fde68a; color: #92400e; }
    .completed { background: #d1fae5; color: #065f46; }

    .dropdown {
      position: absolute;
      right: 10px;
      top: 40px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      box-shadow: 0 10px 20px rgba(0,0,0,.1);
      display: none;
      z-index: 10;
      min-width: 160px;
    }
    .dropdown button {
      display: block;
      width: 100%;
      padding: 10px 14px;
      background: none;
      border: none;
      text-align: left;
      cursor: pointer;
      font-size: 13px;
    }
    .dropdown button:hover {
      background: #f3f4f6;
    }

    /* Scrollable panels – ~15 items visible before scroll */
    #tasks-container, #drafts-container, #completed-container {
      max-height: 480px; /* ≈ 15 rows */
      overflow-y: auto;
      padding: 8px;
    }

    #tasks-container::-webkit-scrollbar,
    #drafts-container::-webkit-scrollbar,
    #completed-container::-webkit-scrollbar {
      width: 6px;
    }
    #tasks-container::-webkit-scrollbar-track,
    #drafts-container::-webkit-scrollbar-track,
    #completed-container::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 10px;
    }
    #tasks-container::-webkit-scrollbar-thumb,
    #drafts-container::-webkit-scrollbar-thumb,
    #completed-container::-webkit-scrollbar-thumb {
      background: #94a3b8;
      border-radius: 10px;
    }
    #tasks-container::-webkit-scrollbar-thumb:hover,
    #drafts-container::-webkit-scrollbar-thumb:hover,
    #completed-container::-webkit-scrollbar-thumb:hover {
      background: #64748b;
    }

    /* Stats & Panels */
    .stats.agent-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1.25rem;
      margin-bottom: 2rem;
    }
    .card {
      background: white;
      padding: 1.25rem;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .panel {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      overflow: hidden;
    }
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.25rem;
      background: #f8fafc;
      border-bottom: 1px solid #e5e7eb;
    }
    .badge.count {
      background: #e5e7eb;
      color: #4b5563;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
    }
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
    }
  </style>
</head>

<body>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <h2>Kisasa</h2>
    <nav>
      <a href="index.html" class="active" title="Dashboard"><i class="fas fa-tachometer-alt"></i></a>
      <a href="leads.html" title="Leads"><i class="fas fa-user-plus"></i></a>
      <a href="clients.html" title="Clients"><i class="fas fa-users"></i></a>
      <a href="quotes.html" title="Quotes"><i class="fas fa-file-invoice-dollar"></i></a>
      <a href="reports.html" title="Reports"><i class="fas fa-chart-line"></i></a>
      <a href="settings.html" title="Settings"><i class="fas fa-cog"></i></a>
    </nav>
  </aside>

  <!-- DASHBOARD CONTENT -->
  <main class="main agent-ui">

    <header class="header agent-header">
      <h1>Agent Dashboard</h1>
      <div class="agent-actions">
        <select class="filter-select">
          <option>Jan</option>
          <option>Feb</option>
          <option>Mar</option>
        </select>

        <a href="addNewlead.html" class="primary-btn">+ Add New Lead</a>

        <div class="agent-info">
          <span class="agent-name">Agent: Duwaine</span>
          <a href="login.html" class="menu-btn">Logout</a>
        </div>
      </div>
    </header>

    <!-- STATS -->
    <section class="stats agent-stats">
      <div class="card"><p>New</p><h2>3</h2></div>
      <div class="card"><p>Deals in progress</p><h2>2</h2></div>
      <div class="card"><p>Leads converted</p><h2>1</h2></div>
      <div class="card"><p>Win Rate</p><h2>33%</h2></div>
    </section>

    <!-- TASKS / DRAFTS / COMPLETED -->
    <section class="agent-grid">

      <!-- TASKS - scrollable, shows email/phone/amount -->
      <div class="panel" id="tasks-panel">
        <div class="panel-header">
          <h3>My Tasks</h3>
          <span class="badge count" id="task-count">0</span>
        </div>
        <div id="tasks-container"></div>
      </div>

      <!-- DRAFTS - starts empty -->
      <div class="panel" id="drafts-panel">
        <div class="panel-header">
          <h3>Drafts</h3>
          <span class="badge count" id="draft-count">0</span>
        </div>
        <div id="drafts-container"></div>
      </div>

      <!-- COMPLETED - starts empty -->
      <div class="panel" id="completed-panel">
        <div class="panel-header">
          <h3>Completed</h3>
          <span class="badge count" id="completed-count">0</span>
        </div>
        <div id="completed-container"></div>
      </div>

    </section>

  </main>
</div>

<script>
// Toggle dropdown menu
function toggleMenu(btn) {
  const menu = btn.nextElementSibling;
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

document.addEventListener("click", e => {
  if (!e.target.closest(".menu-btn")) {
    document.querySelectorAll(".dropdown").forEach(d => d.style.display = "none");
  }
});

// Send Quote
function sendQuote(btn) {
  const row = btn.closest(".task-row");
  const name = row.dataset.name;
  window.location.href = `NewQuote.html?client=${encodeURIComponent(name)}`;
}

// Move to Draft
function moveToDraft(btn) {
  const row = btn.closest(".task-row");
  const name = row.dataset.name;
  const email = row.dataset.email;
  const phone = row.dataset.phone;
  const amount = row.dataset.amount;

  row.remove();
  let drafts = JSON.parse(localStorage.getItem('drafts')) || [];
  drafts.push({ name, email, phone, amount });
  localStorage.setItem('drafts', JSON.stringify(drafts));
  loadDrafts();
  updateCounts();
}

// Move to Completed
function moveToCompleted(btn) {
  const row = btn.closest(".task-row");
  const name = row.dataset.name;
  const email = row.dataset.email;
  const phone = row.dataset.phone;
  const amount = row.dataset.amount;

  row.remove();
  let completed = JSON.parse(localStorage.getItem('completed')) || [];
  completed.push({ name, email, phone, amount });
  localStorage.setItem('completed', JSON.stringify(completed));
  loadCompleted();
  updateCounts();
}

// Load Tasks (My Tasks) - from real localStorage data
function loadTasks() {
  const container = document.getElementById("tasks-container");
  container.innerHTML = '';

  // Load real leads from localStorage (no fake data)
  const tasks = JSON.parse(localStorage.getItem('kisasa_leads') || '[]');

  tasks.forEach(task => {
    const row = document.createElement('div');
    row.className = 'task-row';
    row.dataset.name = `${task.firstName || ''} ${task.lastName || ''}`;
    row.dataset.email = task.email || '';
    row.dataset.phone = task.phone || '';
    row.dataset.amount = task.saleAmount ? `R ${Number(task.saleAmount).toLocaleString()}` : '—';

    row.innerHTML = `
      <div class="task-info">
        <span class="name">${task.firstName || ''} ${task.lastName || ''}</span>
        <span class="detail">Email: ${task.email || '—'}</span>
        <span class="detail">Phone: ${task.phone || '—'}</span>
        <span class="amount">Amount: ${task.saleAmount ? 'R ' + Number(task.saleAmount).toLocaleString() : '—'}</span>
      </div>
      <span class="status ${task.status || 'hot'}">${(task.status || 'HOT').toUpperCase()}</span>
      <button class="menu-btn" onclick="toggleMenu(this)">
        <i class="fas fa-ellipsis-v"></i>
      </button>
      <div class="dropdown">
        <button onclick="sendQuote(this)">Send Quote</button>
        <button onclick="moveToDraft(this)">Move to Draft</button>
        <button onclick="moveToCompleted(this)">Mark Completed</button>
      </div>
    `;
    container.appendChild(row);
  });

  updateCounts();
}

// Load Drafts - starts empty
function loadDrafts() {
  const container = document.getElementById("drafts-container");
  container.innerHTML = '';
  const drafts = JSON.parse(localStorage.getItem('drafts')) || [];

  drafts.forEach(draft => {
    const row = document.createElement('div');
    row.className = 'task-row';
    row.dataset.name = draft.name;
    row.dataset.email = draft.email || '';
    row.dataset.phone = draft.phone || '';
    row.dataset.amount = draft.amount || '—';

    row.innerHTML = `
      <div class="task-info">
        <span class="name">${draft.name}</span>
        <span class="detail">Email: ${draft.email || '—'}</span>
        <span class="detail">Phone: ${draft.phone || '—'}</span>
        <span class="amount">${draft.amount || '—'}</span>
      </div>
      <span class="status draft">DRAFT</span>
      <button class="menu-btn" onclick="toggleMenu(this)">
        <i class="fas fa-ellipsis-v"></i>
      </button>
      <div class="dropdown">
        <button onclick="sendQuote(this)">Send Quote</button>
        <button onclick="moveToCompleted(this)">Move to Completed</button>
      </div>
    `;
    container.appendChild(row);
  });

  updateCounts();
}

// Load Completed - starts empty
function loadCompleted() {
  const container = document.getElementById("completed-container");
  container.innerHTML = '';
  const completed = JSON.parse(localStorage.getItem('completed')) || [];

  completed.forEach(item => {
    const row = document.createElement('div');
    row.className = 'task-row';
    row.innerHTML = `
      <div class="task-info">
        <span class="name">${item.name}</span>
        <span class="detail">Email: ${item.email || '—'}</span>
        <span class="detail">Phone: ${item.phone || '—'}</span>
        <span class="amount">${item.amount || '—'}</span>
      </div>
      <span class="status completed">COMPLETED</span>
    `;
    container.appendChild(row);
  });

  document.getElementById("completed-count").textContent = completed.length;
}

// Update counts
function updateCounts() {
  document.getElementById("task-count").textContent = document.querySelectorAll("#tasks-container .task-row").length;
  document.getElementById("draft-count").textContent = document.querySelectorAll("#drafts-container .task-row").length;
  document.getElementById("completed-count").textContent = document.querySelectorAll("#completed-container .task-row").length;
}

// Initial load
window.addEventListener('load', () => {
  loadTasks();
  loadDrafts();
  loadCompleted();
});
</script>

</body>
</html>