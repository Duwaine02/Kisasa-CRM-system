<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>New Quote - Kisasa CRM</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
    }

    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-500: #6b7280;
      --gray-700: #374151;
      --gray-900: #111827;
      --danger: #ef4444;
    }

    body {
      font-family: 'Inter', sans-serif;
      margin:0;
      background: var(--gray-50);
      color: var(--gray-900);
      overflow-x: hidden;
    }

    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 72px;
      background: #0f172a;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 1.5rem;
      position: fixed;
      inset: 0 auto 0 0;
    }

    .sidebar nav a {
      width:48px;
      height:48px;
      display:flex;
      align-items:center;
      justify-content:center;
      margin-bottom:1.25rem;
      font-size:1.25rem;
      color:#cbd5e1;
      border-radius:8px;
      transition:0.2s;
    }

    .sidebar nav a:hover,
    .sidebar nav a.active {
      background: var(--primary-dark);
      color:white;
    }

    .main {
      margin-left:72px;
      flex:1;
      padding:1.75rem 2rem;
      height:100vh;
      overflow-y:auto;
      overflow-x:hidden;
    }

    h1 {
      font-size:1.75rem;
      font-weight:700;
      margin-bottom:1.25rem;
    }

    .card {
      background:white;
      border-radius:14px;
      box-shadow:0 8px 30px rgba(0,0,0,0.08);
      padding:2rem;
      max-width:1200px;
      margin:auto;
    }

    .section-title {
      font-size:1.15rem;
      font-weight:600;
      color:var(--primary);
      margin:2rem 0 1rem;
      border-bottom:2px solid var(--gray-200);
      padding-bottom:0.25rem;
    }

    .form-row {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
      gap:1.25rem;
      margin-bottom:1.25rem;
    }

    .form-group {
      display:flex;
      flex-direction:column;
      gap:0.4rem;
    }

    label {
      font-size:0.8rem;
      font-weight:500;
      color:var(--gray-700);
    }

    input, select {
      width:100%;
      padding:0.6rem 0.75rem;
      border:1px solid var(--gray-200);
      border-radius:6px;
      font-size:0.85rem;
      background:white;
    }

    input[readonly] {
      background:#f1f5f9;
      cursor:not-allowed;
    }

    /* ===== TABLE FIX ===== */
    .line-items {
      width:100%;
      overflow:hidden;
    }

    .line-items table {
      width:100%;
      table-layout: fixed;
      border-collapse: collapse;
      font-size:0.8rem;
    }

    .line-items th,
    .line-items td {
      padding:0.5rem;
      border-bottom:1px solid var(--gray-200);
      text-align:left;
    }

    .line-items th {
      background: var(--gray-100);
      font-weight:600;
      text-transform:uppercase;
      font-size:0.7rem;
    }

    .line-items input,
    .line-items select {
      width:100%;
      min-width:0;
      padding:0.45rem 0.5rem;
      font-size:0.8rem;
    }

    .totals {
      display:grid;
      grid-template-columns:1fr auto;
      gap:0.5rem;
      max-width:380px;
      margin-left:auto;
      font-size:0.9rem;
      margin-top:1.5rem;
    }

    .totals div {
      display:flex;
      justify-content:space-between;
    }

    .totals .grand-total {
      font-size:1.05rem;
      font-weight:700;
      color: var(--primary-dark);
      border-top:2px solid var(--primary);
      padding-top:0.75rem;
      margin-top:0.5rem;
    }

    .actions {
      display:flex;
      justify-content:flex-end;
      gap:0.75rem;
      margin-top:2rem;
      padding-top:1.25rem;
      border-top:1px solid var(--gray-200);
    }

    .btn {
      padding:0.6rem 1.25rem;
      border-radius:6px;
      font-weight:600;
      cursor:pointer;
      border:none;
      font-size:0.85rem;
    }

    .btn-cancel { background: var(--gray-200); }
    .btn-save { background: var(--primary); color:white; }
    .btn-save:hover { background: var(--primary-dark); }

    @media (max-width: 900px) {
      .main {
        padding:1.25rem;
      }
      h1 {
        font-size:1.5rem;
      }
    }
  </style>
</head>

<body>

<div class="layout">
  <aside class="sidebar">
    <nav>
      <a href="/index.html"><i class="fas fa-tachometer-alt"></i></a>
      <a href="/leads.html"><i class="fas fa-user-plus"></i></a>
      <a href="/clients.html"><i class="fas fa-users"></i></a>
      <a href="/quotes.html" class="active"><i class="fas fa-file-invoice-dollar"></i></a>
      <a href="/reports.html"><i class="fas fa-chart-line"></i></a>
      <a href="/settings.html"><i class="fas fa-cog"></i></a>
    </nav>
  </aside>

  <main class="main">
    <h1>Create New Quote</h1>

    <div class="card">
      <!-- Quote Info -->
      <div class="section-title">Quote Information</div>
      <div class="form-row">
        <div class="form-group">
          <label>Quote Number</label>
          <input type="text" id="quoteNumber" readonly />
        </div>
        <div class="form-group">
          <label>Quote Date</label>
          <input type="date" id="quoteDate" readonly />
        </div>
        <div class="form-group">
          <label>Expiry Date</label>
          <input type="date" id="expiryDate"/>
        </div>
      </div>

      <!-- Services -->
      <div class="section-title">Services</div>
      <div class="line-items">
        <table>
          <thead>
            <tr>
              <th>Service</th>
              <th>Ref</th>
              <th>Price</th>
              <th>Disc %</th>
              <th>VAT %</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
                <select class="service">
                  <option value="1000">Debt Review (DR)</option>
                  <option value="1500">Debt Prescription (DP)</option>
                  <option value="2500">Legal Clearance</option>
                  <option value="3500">Full Financial Assessment</option>
                </select>
              </td>
              <td><input type="text"/></td>
              <td><input type="number" class="price" value="1000"/></td>
              <td><input type="number" class="discount" value="0"/></td>
              <td><input type="number" class="vat" value="15"/></td>
              <td><input type="text" class="total" readonly/></td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Totals -->
      <div class="totals">
        <div><span>Total Discount</span><span id="totalDiscount">0.00</span></div>
        <div><span>Total Exclusive</span><span id="totalExcl">0.00</span></div>
        <div><span>Total VAT</span><span id="totalVat">0.00</span></div>
        <div class="grand-total"><span>Grand Total</span><span id="grandTotal">0.00</span></div>
      </div>

      <div class="actions">
        <button class="btn btn-cancel" onclick="window.location.href='/quotes.html'">Cancel</button>
        <button class="btn btn-save" id="sendQuoteBtn">Send Quote</button>
      </div>
    </div>
  </main>
</div>

<script>
window.addEventListener('load', () => {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('quoteDate').value = today;

  let lastId = localStorage.getItem('lastQuoteId') || 90000;
  lastId++;
  document.getElementById('quoteNumber').value = "QUO" + lastId;
  localStorage.setItem('lastQuoteId', lastId);

  calculateTotals();
});

document.querySelector('.service').addEventListener('change', function(){
  this.closest('tr').querySelector('.price').value = this.value;
  calculateTotals();
});

document.querySelectorAll('.price, .discount, .vat').forEach(el=>{
  el.addEventListener('input', calculateTotals);
});

function calculateTotals(){
  let totalExcl=0, totalVat=0, totalDisc=0;

  document.querySelectorAll('tbody tr').forEach(row=>{
    const price = +row.querySelector('.price').value || 0;
    const disc = +row.querySelector('.discount').value || 0;
    const vat = +row.querySelector('.vat').value || 0;

    const discounted = price - (price*disc/100);
    const vatAmount = discounted * vat/100;
    row.querySelector('.total').value = (discounted + vatAmount).toFixed(2);

    totalDisc += price*disc/100;
    totalExcl += discounted;
    totalVat += vatAmount;
  });

  document.getElementById('totalDiscount').textContent = totalDisc.toFixed(2);
  document.getElementById('totalExcl').textContent = totalExcl.toFixed(2);
  document.getElementById('totalVat').textContent = totalVat.toFixed(2);
  document.getElementById('grandTotal').textContent = (totalExcl + totalVat).toFixed(2);
}
</script>

</body>
</html>
