<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leads - Kisasa CRM</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --primary:#3b82f6;
      --sidebar-bg:#0f172a;
      --gray-100:#f3f4f6;
      --gray-200:#e5e7eb;
      --text:#1e293b;
    }

    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      font-family:Inter,sans-serif;
      background:#f8fafc;
      color:var(--text);
    }

    /* Layout */
    .layout{display:flex;}
    .sidebar{
      width:70px;
      background:var(--sidebar-bg);
      position:fixed;
      height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding-top:1.5rem;
    }
    .sidebar nav a{
      width:50px;height:50px;
      display:flex;align-items:center;justify-content:center;
      margin-bottom:1.2rem;
      color:#cbd5e1;
      border-radius:8px;
      transition: all 0.2s;
    }
    .sidebar nav a.active,
    .sidebar nav a:hover{
      background:#1e293b;color:#fff;
    }

    .main{
      margin-left:70px;
      padding:2rem 2.5rem;
      width:100%;
      max-width:1400px;
    }

    /* Header */
    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1.5rem;
    }
    .page-header h1{font-size:1.8rem;font-weight:700;}

    /* Filters */
    .filters{
      display:flex;
      flex-wrap:wrap;
      gap:.6rem;
      margin-bottom:1rem;
    }
    .filter{
      padding:.45rem .9rem;
      border-radius:999px;
      background:var(--gray-100);
      cursor:pointer;
      font-size:.85rem;
      font-weight:600;
      text-decoration:none;
      color: inherit;
    }
    .filter.active{
      background:var(--primary);
      color:#fff;
    }

    /* Search */
    .search-box{
      display:flex;
      justify-content:flex-end;
      margin-bottom:1.25rem;
    }
    .search-box input{
      width:260px;
      padding:.55rem 1rem;
      border:1px solid var(--gray-200);
      border-radius:6px;
    }
    .search-box input:focus{
      outline:none;
      border-color:var(--primary);
    }

    /* Table */
    .table-wrap{
      background:#fff;
      border-radius:12px;
      box-shadow:0 4px 16px rgba(0,0,0,.06);
      overflow-x:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:850px;
    }
    th,td{
      padding:.9rem 1.2rem;
      border-bottom:1px solid var(--gray-200);
      font-size:.9rem;
    }
    th{font-weight:600;text-transform:uppercase;font-size:.75rem;}
    tbody tr:hover{background:#f9fafb;}

    .badge{
      padding:.3rem .7rem;
      border-radius:999px;
      font-size:.75rem;
      font-weight:600;
      text-transform:capitalize;
    }
    .client{background:#dbeafe;color:#1e40af;}
    .old-client{background:#e5e7eb;color:#374151;}
    .hot{background:#fee2e2;color:#991b1b;}
    .warm{background:#fef3c7;color:#92400e;}
    .cold{background:#e0f2fe;color:#075985;}

    @media(max-width:768px){
      .main{padding:1.5rem;}
      .search-box{justify-content:center;}
    }
  </style>
</head>

<body>
<div class="layout">

<!-- Sidebar â€“ FIXED LINKS (no leading /) -->
<aside class="sidebar">
  <nav>
    <a href="index.html"><i class="fas fa-tachometer-alt"></i></a>
    <a href="leads.html" class="active"><i class="fas fa-user-plus"></i></a>
    <a href="clients.html"><i class="fas fa-users"></i></a>
    <a href="quotes.html"><i class="fas fa-file-invoice-dollar"></i></a>
    <a href="reports.html"><i class="fas fa-chart-line"></i></a>
    <a href="settings.html"><i class="fas fa-cog"></i></a>
  </nav>
</aside>

<!-- Main -->
<main class="main">
  <div class="page-header">
    <h1>Leads & Clients</h1>
  </div>

  <!-- Filters -->
  <div class="filters">
    <a href="javascript:void(0)" class="filter" data-status="all">All</a>
    <a href="clients.html" class="filter">Clients</a>
    <a href="javascript:void(0)" class="filter" data-status="old-client">Old Clients</a>
    <a href="javascript:void(0)" class="filter" data-status="hot">Hot</a>
    <a href="javascript:void(0)" class="filter" data-status="warm">Warm</a>
    <a href="javascript:void(0)" class="filter" data-status="cold">Cold</a>
  </div>

  <!-- Search -->
  <div class="search-box">
    <input type="text" id="searchInput" placeholder="Search name, email, phone, ID or status">
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Client</th>
          <th>Email</th>
          <th>ID Number</th>
          <th>Cell</th>
          <th>Status</th>
          <th>Date</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</main>
</div>

<script>
// Load leads data from localStorage
const data = JSON.parse(localStorage.getItem('kisasa_leads') || '[]');
const body = document.getElementById('tableBody');
const filters = document.querySelectorAll('.filter');
const search = document.getElementById('searchInput');

// Load last active filter
let currentFilter = localStorage.getItem('activeFilter') || 'all';

// Render table
function render(){
  body.innerHTML = '';
  const term = search.value.toLowerCase();

  const rows = data.filter(d => {
    let matchesFilter = false;
    if(currentFilter === 'all') matchesFilter = true;
    else if(currentFilter === 'old-client') matchesFilter = d.status === 'old-client';
    else if(currentFilter === 'hot') matchesFilter = d.status === 'hot';
    else if(currentFilter === 'warm') matchesFilter = d.status === 'warm';
    else if(currentFilter === 'cold') matchesFilter = d.status === 'cold';
    else matchesFilter = true;

    const matchesSearch =
      `${d.firstName} ${d.lastName}`.toLowerCase().includes(term) ||
      d.email?.toLowerCase().includes(term) ||
      d.phone?.includes(term) ||
      d.idNumber?.includes(term) ||
      d.status?.toLowerCase().includes(term);

    return matchesFilter && matchesSearch;
  });

  if(!rows.length){
    body.innerHTML = `<tr><td colspan="6" style="text-align:center;padding:1rem;">No records found</td></tr>`;
    return;
  }

  rows.forEach(d => {
    body.innerHTML += `
      <tr>
        <td>${d.firstName} ${d.lastName}</td>
        <td>${d.email || ''}</td>
        <td>${d.idNumber || ''}</td>
        <td>${d.phone || ''}</td>
        <td><span class="badge ${d.status}">${d.status.replace('-',' ')}</span></td>
        <td>${d.date || ''}</td>
      </tr>`;
  });
}

// Highlight active filter
function setActiveFilter() {
  filters.forEach(f => {
    f.classList.remove('active');
    if(f.dataset.status === currentFilter) f.classList.add('active');
    if(window.location.pathname.endsWith('clients.html') && f.href && f.href.includes('clients.html')){
      f.classList.add('active');
    }
  });
}

// Add click events for filters
filters.forEach(f => {
  if(!f.href || f.href.includes('javascript:void(0)')){
    f.addEventListener('click', () => {
      currentFilter = f.dataset.status || 'all';
      localStorage.setItem('activeFilter', currentFilter);
      setActiveFilter();
      render();
    });
  }
});

// Initialize
setActiveFilter();
render();
search.addEventListener('input', render);
</script>

</body>
</html>